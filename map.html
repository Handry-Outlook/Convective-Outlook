
    <!DOCTYPE html>
    <html>
    <head>
        <meta charset="utf-8" />
        <title>Mapbox GL JS Map with KML Polygons</title>
        <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
        <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
        <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
        <style>
            body { margin: 0; padding: 0; }
            #map { position: absolute; top: 0; bottom: 0; width: 100%; height: 100%; }
        </style>
    </head>
    <body>
        <div id="map"></div>
        <script>
            mapboxgl.accessToken = 'pk.eyJ1IjoiaGFuZHJ5LW91dGxvb2siLCJhIjoiY2xrbnNrbmVlMXo0NDNqa2d3MTY2NW90bCJ9.AJbccNwtKvKA8il3JkE3PA';
            const map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/handry-outlook/cm6dn4z49008801s2f3qd29he/draft',  // Your custom style
                center: [-4.0, 54.5],
                zoom: 5,
                maxBounds: [[-11, 47], [3, 3]],
                minZoom: 5,
                maxZoom: 5
            });

            map.on('load', () => {
                // Add GeoJSON data as a source
                map.addSource('kml-polygons', {
                    type: 'geojson',
                    data: {"type": "FeatureCollection", "features": [{"id": "0", "type": "Feature", "properties": {"Name": "Low risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-1.623437, 55.658065, 0.0], [-3.579004, 54.69193, 0.0], [-3.820703, 54.129292, 0.0], [-3.809716, 53.198463, 0.0], [-3.447168, 52.595372, 0.0], [-3.540551, 51.909372, 0.0], [-3.539953, 51.684716, 0.0], [-3.183496, 51.452978, 0.0], [-3.1450603, 51.315643, 0.0], [-3.1944822, 51.1783078, 0.0], [-3.4554833, 51.1022231, 0.0], [-3.5619058, 50.9844491, 0.0], [-3.5097415, 50.8773492, 0.0], [-3.3263178, 50.7562654, 0.0], [-2.9352593, 50.6555374, 0.0], [-2.700097, 50.442462, 0.0], [-2.227685, 50.239123, 0.0], [-1.601464, 49.907724, 0.0], [-0.876367, 49.7021, 0.0], [-0.11831, 49.7021, 0.0], [0.782569, 49.978426, 0.0], [1.276953, 50.288284, 0.0], [1.573584, 50.881201, 0.0], [1.936133, 51.24713, 0.0], [2.122901, 51.39132, 0.0], [2.24375, 51.535059, 0.0], [2.276709, 51.644269, 0.0], [2.419532, 51.875472, 0.0], [2.419532, 52.132475, 0.0], [2.331641, 52.414816, 0.0], [2.067969, 52.848233, 0.0], [1.573584, 53.027007, 0.0], [0.947364, 53.36268, 0.0], [0.507911, 53.786696, 0.0], [-0.092008, 54.356064, 0.0], [-0.421598, 54.744747, 0.0], [-0.729215, 55.035408, 0.0], [-1.080778, 55.548356, 0.0], [-1.395673, 55.690303, 0.0], [-1.623437, 55.658065, 0.0]]]}}, {"id": "1", "type": "Feature", "properties": {"Name": "Slight risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-1.52048, 54.946182, 0.0], [-1.894015, 54.724727, 0.0], [-2.663058, 54.252498, 0.0], [-2.9926481, 53.9755826, 0.0], [-3.0079998, 53.6962436, 0.0], [-2.8298959, 53.5368253, 0.0], [-2.7839073, 53.3899904, 0.0], [-2.7399621, 53.173229, 0.0], [-2.613619, 52.909013, 0.0], [-2.602633, 52.71977, 0.0], [-2.685031, 52.566446, 0.0], [-2.888278, 52.395828, 0.0], [-3.140963, 52.13023, 0.0], [-3.261813, 51.896948, 0.0], [-3.223361, 51.716934, 0.0], [-3.01462, 51.641999, 0.0], [-2.723723, 51.541716, 0.0], [-2.646578, 51.423304, 0.0], [-2.602634, 51.320429, 0.0], [-2.985125, 51.0981948, 0.0], [-3.1209183, 50.9645029, 0.0], [-3.0585653, 50.8442208, 0.0], [-2.9596052, 50.738269, 0.0], [-2.6355916, 50.6391269, 0.0], [-2.185264, 50.558229, 0.0], [-1.361178, 50.576378, 0.0], [-0.976656, 50.590329, 0.0], [-0.526217, 50.618219, 0.0], [-0.125217, 50.646095, 0.0], [0.486146, 50.664501, 0.0], [0.847074, 50.67047, 0.0], [1.127226, 50.747, 0.0], [1.495267, 50.91354, 0.0], [1.835844, 51.316996, 0.0], [1.929227, 51.450698, 0.0], [2.006132, 51.67267, 0.0], [1.84683, 51.822312, 0.0], [1.470835, 51.937671, 0.0], [1.237088, 51.984994, 0.0], [1.094266, 52.042469, 0.0], [0.923978, 52.153828, 0.0], [0.803129, 52.244732, 0.0], [0.63284, 52.446078, 0.0], [0.421554, 52.659835, 0.0], [0.09451, 52.869241, 0.0], [-0.215702, 53.110683, 0.0], [-0.4657932, 53.2850312, 0.0], [-0.559176, 53.4096419, 0.0], [-0.564669, 53.76181, 0.0], [-0.4438195, 54.1046098, 0.0], [-0.372409, 54.419037, 0.0], [-0.520724, 54.645341, 0.0], [-0.630587, 54.807123, 0.0], [-0.938205, 54.952491, 0.0], [-1.146945, 55.012382, 0.0], [-1.52048, 54.946182, 0.0]]]}}, {"id": "2", "type": "Feature", "properties": {"Name": "Enhanced risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-2.8422256, 52.146301, 0.0], [-2.8751845, 52.0129526, 0.0], [-2.8751845, 51.9317362, 0.0], [-2.7818008, 51.7722608, 0.0], [-2.471437, 51.6446141, 0.0], [-2.2984023, 51.4841214, 0.0], [-2.1995254, 51.3745255, 0.0], [-2.2517104, 51.2251217, 0.0], [-2.5488581, 51.1670081, 0.0], [-2.8669448, 51.0769571, 0.0], [-2.9358442, 51.0146478, 0.0], [-2.9092552, 50.8896285, 0.0], [-2.8388387, 50.8164641, 0.0], [-2.537355, 50.7583542, 0.0], [-2.1857925, 50.7340233, 0.0], [-1.8507095, 50.7201143, 0.0], [-1.4442153, 50.7340233, 0.0], [-1.2849136, 50.7722519, 0.0], [-1.1530776, 50.761829, 0.0], [-1.0487075, 50.7479282, 0.0], [-0.8454604, 50.7096798, 0.0], [-0.6751723, 50.723592, 0.0], [-0.3675552, 50.7653035, 0.0], [-0.0874038, 50.7583542, 0.0], [0.1433091, 50.723592, 0.0], [0.341063, 50.7305465, 0.0], [0.634842, 50.78204, 0.0], [1.0002427, 50.8971452, 0.0], [1.2364488, 51.0113373, 0.0], [1.4342027, 51.1286964, 0.0], [1.7033677, 51.2938735, 0.0], [1.813231, 51.4105157, 0.0], [1.879149, 51.526861, 0.0], [1.9011216, 51.6088085, 0.0], [1.8352037, 51.7042273, 0.0], [1.72542, 51.7605152, 0.0], [1.5220933, 51.7620623, 0.0], [1.1485582, 51.7586623, 0.0], [0.7255845, 51.8401917, 0.0], [0.5443101, 51.9757467, 0.0], [0.43994, 52.1749441, 0.0], [0.2806382, 52.2994113, 0.0], [0.0554185, 52.4268794, 0.0], [-0.1845497, 52.5012297, 0.0], [-0.4636482, 52.4914927, 0.0], [-0.9553237, 52.376607, 0.0], [-1.6145034, 52.376607, 0.0], [-2.1198745, 52.4503203, 0.0], [-2.4384781, 52.4235297, 0.0], [-2.7131362, 52.2893324, 0.0], [-2.8422256, 52.146301, 0.0]]]}}, {"id": "3", "type": "Feature", "properties": {"Name": "Risk of large hail, flooding and tornado", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-2.0238967, 52.053225, 0.0], [-2.1008308, 51.924625, 0.0], [-2.0568619, 51.6901716, 0.0], [-1.957938, 51.4099597, 0.0], [-1.9798926, 51.2107057, 0.0], [-2.1062461, 51.0520754, 0.0], [-2.0952419, 50.9310135, 0.0], [-1.9990981, 50.8478252, 0.0], [-1.7188765, 50.7957476, 0.0], [-1.5375508, 50.7855671, 0.0], [-1.2600079, 50.7905484, 0.0], [-0.9045314, 50.7511401, 0.0], [-0.7829683, 50.7408343, 0.0], [-0.5847328, 50.7571408, 0.0], [-0.3340718, 50.7888088, 0.0], [-0.0812102, 50.7801196, 0.0], [0.0692826, 50.7555426, 0.0], [0.2388833, 50.7307513, 0.0], [0.3686405, 50.7511224, 0.0], [0.460029, 50.7749017, 0.0], [0.7664169, 50.8738352, 0.0], [0.9903557, 50.9275526, 0.0], [1.0975182, 51.0106078, 0.0], [1.1964374, 51.0797069, 0.0], [1.3613016, 51.1383592, 0.0], [1.4382397, 51.2107108, 0.0], [1.4547282, 51.2829496, 0.0], [1.5096853, 51.3722307, 0.0], [1.4382468, 51.444217, 0.0], [1.1854576, 51.4887255, 0.0], [0.8667226, 51.5366092, 0.0], [0.6249247, 51.6458638, 0.0], [0.5151737, 51.7785756, 0.0], [0.4710558, 51.8839405, 0.0], [0.3886259, 52.0363276, 0.0], [0.3061961, 52.211775, 0.0], [0.2017824, 52.289157, 0.0], [0.0863767, 52.3026014, 0.0], [-0.2213723, 52.295881, 0.0], [-0.5126348, 52.2757111, 0.0], [-1.0347084, 52.221878, 0.0], [-1.4853397, 52.1780893, 0.0], [-1.8590329, 52.1106382, 0.0], [-1.979933, 52.0667407, 0.0], [-2.0238967, 52.053225, 0.0]]]}}, {"id": "4", "type": "Feature", "properties": {"Name": "Moderate risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-2.1013423, 51.1548982, 0.0], [-2.1837398, 51.0410597, 0.0], [-2.2057125, 50.9200154, 0.0], [-2.1123287, 50.8298924, 0.0], [-1.9310542, 50.7778191, 0.0], [-1.5959712, 50.8125411, 0.0], [-1.2608882, 50.8160119, 0.0], [-0.7225582, 50.8298924, 0.0], [-0.189133, 50.830639, 0.0], [0.051978, 50.8541735, 0.0], [0.4035405, 50.8576412, 0.0], [0.5517118, 50.9217046, 0.0], [0.7084111, 51.0065078, 0.0], [0.7647131, 51.1065364, 0.0], [0.7715825, 51.2237549, 0.0], [0.5824998, 51.3234943, 0.0], [0.42002, 51.4331327, 0.0], [0.2112797, 51.6142756, 0.0], [0.0409916, 51.7164901, 0.0], [-0.2500601, 51.762537, 0.0], [-0.62746, 51.78793, 0.0], [-0.8653804, 51.8863355, 0.0], [-1.0906001, 52.0589191, 0.0], [-1.3927242, 52.1466471, 0.0], [-1.7168209, 52.1500179, 0.0], [-1.9804927, 52.1196723, 0.0], [-2.1343013, 52.0622964, 0.0], [-2.1947261, 51.950709, 0.0], [-2.1837398, 51.8082861, 0.0], [-2.1343013, 51.7164901, 0.0], [-2.0793697, 51.5664966, 0.0], [-2.0628902, 51.4570986, 0.0], [-2.0299312, 51.3508686, 0.0], [-2.0519039, 51.2684566, 0.0], [-2.0519039, 51.1927821, 0.0], [-2.1013423, 51.1548982, 0.0]]]}}, {"id": "5", "type": "Feature", "properties": {"Name": "High risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-1.7114532, 51.9033234, 0.0], [-1.7773711, 51.7930384, 0.0], [-1.8020904, 51.7148272, 0.0], [-1.8130767, 51.5562905, 0.0], [-1.8323028, 51.446868, 0.0], [-1.8350494, 51.3251698, 0.0], [-1.8350494, 51.184214, 0.0], [-1.8266841, 51.0548732, 0.0], [-1.7773711, 50.9598613, 0.0], [-1.7087066, 50.9044691, 0.0], [-1.6098296, 50.8715488, 0.0], [-1.5301788, 50.8802143, 0.0], [-1.3487789, 50.9096255, 0.0], [-1.1126983, 50.9892615, 0.0], [-0.9836089, 51.0963284, 0.0], [-0.9533965, 51.1807707, 0.0], [-0.9655086, 51.3842421, 0.0], [-0.9808624, 51.4554261, 0.0], [-1.0440337, 51.5733641, 0.0], [-1.1401641, 51.7250363, 0.0], [-1.2445342, 51.811721, 0.0], [-1.3406646, 51.8762014, 0.0], [-1.4725005, 51.9202663, 0.0], [-1.587857, 51.9405894, 0.0], [-1.6592681, 51.9236542, 0.0], [-1.7114532, 51.9033234, 0.0]]]}}, {"id": "6", "type": "Feature", "properties": {"Name": "High risk", "Description": "https://handryoutlook.wixsite.com/website/post/convective-outlook-updated-high-risk-01-08-2024-00-00-01-08-2024-23-59"}, "geometry": {"type": "Polygon", "coordinates": [[[-0.1651399, 51.4844736, 0.0], [-0.2229118, 51.4194868, 0.0], [-0.2339746, 51.3595245, 0.0], [-0.225757, 51.2634131, 0.0], [-0.1982876, 51.1980508, 0.0], [-0.1296148, 51.1274241, 0.0], [-0.0746767, 51.087757, 0.0], [0.0956311, 51.0273288, 0.0], [0.2412165, 51.0065926, 0.0], [0.4294397, 51.0189438, 0.0], [0.5049179, 51.0566905, 0.0], [0.5062613, 51.0878968, 0.0], [0.5049173, 51.1722258, 0.0], [0.4664606, 51.229025, 0.0], [0.4032817, 51.2788817, 0.0], [0.3043989, 51.3372293, 0.0], [0.175289, 51.4143372, 0.0], [-0.0002826, 51.514465, 0.0], [-0.1156662, 51.5131618, 0.0], [-0.1651399, 51.4844736, 0.0]]]}}]}
                });

                // Add layers for each polygon, ordered by risk level
                const riskLevels = {"Low risk": 10, "Slight risk": 20, "Enhanced risk": 30, "Moderate risk": 40, "High risk": 50, "Risk of flooding": 60, "Risk of large hail": 60, "Risk of tornado": 60, "Risk of strong gusts": 60, "Risk of large hail, flooding and tornado": 60};
                const riskColors = {"Low risk": "#00FF00", "Slight risk": "#FFFF00", "Enhanced risk": "#FFA500", "Moderate risk": "#FF0000", "High risk": "#800080", "Risk of flooding": "#000000", "Risk of large hail": "#000000", "Risk of tornado": "#000000", "Risk of strong gusts": "#000000", "Risk of large hail, flooding and tornado": "#000000"};
                const outlineOnlyRisks = ['Risk of flooding', 'Risk of large hail', 'Risk of tornado', 'Risk of strong gusts', 'Risk of large hail, flooding and tornado'];
                
                Object.keys(riskLevels).forEach(riskName => {
                    map.addLayer({
                        id: `polygon-${riskName.replace(" ", "-").toLowerCase()}`,
                        type: 'fill',
                        source: 'kml-polygons',
                        filter: ['==', ['get', 'Name'], riskName],
                        paint: {
                            'fill-color': riskColors[riskName],
                            'fill-opacity': outlineOnlyRisks.includes(riskName) ? 0.0 : 0.3,
                            'fill-outline-color': riskColors[riskName]
                        }
                    }, 'waterway-label');  // Place below labels for better visibility

                    // Add outline layer for outline-only risks
                    if (outlineOnlyRisks.includes(riskName)) {
                        map.addLayer({
                            id: `outline-${riskName.replace(" ", "-").toLowerCase()}`,
                            type: 'line',
                            source: 'kml-polygons',
                            filter: ['==', ['get', 'Name'], riskName],
                            paint: {
                                'line-color': '#000000',
                                'line-width': 2
                            }
                        }, 'waterway-label');
                    }
                });

                // Fit the map to the bounds of the KML data, but ensure it stays within UK bounds
                const bounds = [[-11, 47], [3, 3]];
                map.fitBounds(bounds, { padding: 20 });
            });
        </script>
    </body>
    </html>
    